openapi: 3.1.0
info:
  title: API COPC Insights – Extensions Intelligentes
  version: 1.0.1
  description: >
    Ce module complémentaire enrichit l’assistant COPC avec des fonctionnalités utiles :
    réponses intelligentes à la norme COPC, calibrage multi-évaluateurs, détection automatique d’alertes qualité.

servers:
  - url: https://api.copc-audit.com/v1
    description: "Serveur complémentaire – Insights qualité"

paths:

  /faq-copc:
    post:
      operationId: repondreQuestionCopc
      summary: Répondre à une question sur la norme COPC v7.0
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - question
              properties:
                question:
                  type: string
                  description: "Exemple : Que dit l’item 3.5 sur la fréquence d’évaluation ?"
      responses:
        '200':
          description: Réponse normative claire
          content:
            application/json:
              schema:
                type: object
                properties:
                  reponse:
                    type: string
                  referenceNorme:
                    type: string
        '400':
          description: Requête incomplète
        '500':
          description: Erreur serveur

  /calibrage-multi-evaluateurs:
    post:
      operationId: analyserCalibrage
      summary: Comparer plusieurs évaluations QA d’une même transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - grilles
              properties:
                grilles:
                  type: array
                  items:
                    type: object
                    properties:
                      evaluateur:
                        type: string
                      score:
                        type: number
                      erreurs:
                        type: array
                        items:
                          type: string
      responses:
        '200':
          description: Résultat de l’analyse calibrage
          content:
            application/json:
              schema:
                type: object
                properties:
                  synthese:
                    type: string
                  divergences:
                    type: array
                    items:
                      type: string
                  notationReference:
                    type: string
        '500':
          description: Erreur serveur

  /alertes-qualite:
    post:
      operationId: genererAlertesQualite
      summary: Détecter automatiquement les alertes qualité sur la base de données historiques
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - plateau
                - historiqueScores
              properties:
                plateau:
                  type: string
                historiqueScores:
                  type: array
                  items:
                    type: object
                    properties:
                      semaine:
                        type: string
                      scoreMoyen:
                        type: number
      responses:
        '200':
          description: Liste des alertes détectées
          content:
            application/json:
              schema:
                type: object
                properties:
                  alertes:
                    type: array
                    items:
                      type: string
                  interpretation:
                    type: string
        '500':
          description: Erreur serveur
